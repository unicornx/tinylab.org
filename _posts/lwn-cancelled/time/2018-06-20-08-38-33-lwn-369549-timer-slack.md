---
layout: post
author: 'Wang Chen'
title: "LWN 369549: XXX"
album: 'LWN 中文翻译'
group: translation
license: "cc-by-sa-4.0"
permalink: /lwn-369549-timer-slack/
description: "LWN 文章翻译，XXX"
category:
  - 时钟系统
  - LWN
tags:
  - Linux
  - timer
---

> 原文：[Timer slack](https://lwn.net/Articles/369549/)
> 原创：By corbet @ Jan. 12, 2010
> 翻译：By [unicornx](https://github.com/unicornx) of [TinyLab.org][1]
> 校对：By [guojian-at-wowo](https://github.com/guojian-at-wowo)

> One of the best ways to reduce a system's power usage is to avoid waking up the CPU whenever possible. Minimizing wakeups, in turn, is facilitated by ensuring that timers expire at the same time when it makes sense to do so. Waking the processor once to handle two timers is much more efficient than handling them in two separate wakeups. But doing so typically requires adjusting expiration times. For standard (not high resolution) kernel timers, the only way to make that adjustment is with the `round_jiffies()` function, which makes timeout periods coarser in the hopes that they will coincide more often. This method works to an extent, but it requires code changes wherever timers are used.

减少系统功耗的最佳方法之一是尽可能避免唤醒CPU。 反过来，通过确保定时器在合理时同时过期来最大程度地减少唤醒。 唤醒处理器一次来处理两个定时器比在两个独立的唤醒中处理它们要有效得多。 但这样做通常需要调整到期时间。 对于标准（不是高分辨率）内核定时器，进行这种调整的唯一方法是使用round_jiffies（）函数，它使得超时期间更粗，希望它们更频繁地重合。 这种方法在一定程度上起作用，但它需要在使用定时器的地方更改代码。

> Arjan van de Ven has proposed an enhancement to the timer API - called [timer slack](http://lwn.net/Articles/369361/) - which should make it easier to coalesce timer events. In essence, it adds a certain amount of fuzziness to timer expiration times, giving the kernel some flexibility in how the timers are scheduled. That fuzziness is set with:

Arjan van de Ven提出了对计时器API的改进 - 称为[timer slack]（计时器松弛）（http://lwn.net/Articles/369361/） - 这应该使合并计时器事件变得更容易。 实质上，它在计时器到期时间中增加了一定的模糊性，使内核在计划定时器方面具有一定的灵活性。 这种模糊性被设置为：

    void set_timer_slack(struct timer_list *timer, int slack_hz);

> In essence, this call says that any timeout scheduled with the given timer can be delayed by up to `slack_hz` jiffies. By default, the slack is set to 0.4% of the total timeout period - a very conservative value. When the timer is queued, the actual expiration time is determined by means of a simple algorithm to choose a well-defined time within the slack period.

实质上，这个调用表明，使用给定定时器计划的任何超时都可以延迟到`slack_hz` jiffies。 默认情况下，松弛设置为总超时时间的0.4％ - 一个非常保守的值。 当计时器排队时，实际的到期时间通过简单的算法来确定，以在松弛时间段内选择明确的时间。

> The value of this approach is that it makes it easy to coalesce timer events from multiple sources without needing to change every call site. Additional flexibility can then be had by increasing the slack for specific, frequently-used timers, but, even without that, slack timers should improve power efficiency on many systems.

这种方法的价值在于，它可以轻松地合并来自多个来源的计时器事件，而无需更改每个呼叫站点。 通过增加特定的，经常使用的定时器的余量，可以增加灵活性，但即使没有这些，定时器的松弛也会提高许多系统的功率效率。

[1]: http://tinylab.org
